name: Build OnePlus SukiSU Ultra
on:
  workflow_dispatch:
    inputs:
      CPU:
        description: "CPUåˆ†æ”¯"
        required: true
        type: choice
        options:
          - 'sm8650'
          - 'sm8550'
          - 'sm8450'
          - 'sm8475'
          - 'sm7675'
        default: 'sm8650'
      FEIL:
        description: "æ‰‹æœºå‹å·"
        required: true
        type: choice
        options:
          - 'oneplus_12'
          - 'oneplus_ace3_pro'
          - 'oneplus_ace5'
          - 'oneplus_pad2'
          - 'oneplus_11'
          - 'oneplus_12r'
          - 'oneplus_ace2pro'
          - 'oneplus_ace3'
          - 'oneplus_open'
          - 'oneplus_10t'
          - 'oneplus_11r'
          - 'oneplus_ace2'
          - 'oneplus_ace_pro'
          - 'oneplus_10_pro'
          - 'oneplus_ace_3v'
          - 'other'
        default: 'oneplus_12'
      CPUD:
        description: "å¤„ç†å™¨ä»£å·"
        required: true
        type: choice
        options:
          - 'pineapple'
          - 'kalama'
          - 'waipio'
        default: 'pineapple'
      ANDROID_VERSION:
        description: "å†…æ ¸å®‰å“ç‰ˆæœ¬"
        required: true
        type: choice
        options:
          - 'android14'
          - 'android13'
          - 'android12'
        default: 'android14'
      KERNEL_VERSION:
        description: "å†…æ ¸ç‰ˆæœ¬"
        required: true
        type: choice
        options:
          - '6.1'
          - '5.15'
          - '5.10'
        default: '6.1'
      KERNEL_SUFFIX:
        description: 'å†…æ ¸åç§°ä¿®æ”¹(å¯æ”¹ä¸­æ–‡å’Œemoji)'
        required: true
        default: '-Coolapk@Suxiaoqing'
      KPM_ext:
       description: "æ˜¯å¦å¯ç”¨KPMè¡¥ä¸ä¿®è¡¥"
       required: true
       type: choice
       options:
          - 'true'
          - 'false'
       default: 'false'
      lz4kd:
       description: "æ˜¯å¦å¯ç”¨lz4kd"
       required: true
       type: choice
       options:
          - 'Open'
          - 'Close'
       default: 'Open'
      sched_ext:
       description: "æ˜¯å¦åˆ·å…¥é£é©°å†…æ ¸è°ƒåº¦"
       required: true
       type: choice
       options:
          - 'true'
          - 'false'
       default: 'false'
        
jobs:
  build:
    name: For ${{ github.event.inputs.FEIL }} lz4kd ${{ github.event.inputs.lz4kd }} sched_ext ${{ github.event.inputs.sched_ext }}
    runs-on: ubuntu-latest
    env:
      CCACHE_COMPILERCHECK: "%compiler% -dumpmachine; %compiler% -dumpversion"
      CCACHE_NOHASHDIR: "true"
      CCACHE_HARDLINK: "true"
      CCACHE_DIR: /home/runner/.ccache  
      CCACHE_MAXSIZE: 8G
    steps:
      - name: ğŸš€ Maximize build space (æœ€å¤§åŒ–æ„å»ºç©ºé—´)
        uses: easimon/maximize-build-space@master
        with:
          root-reserve-mb: 8192
          temp-reserve-mb: 2048
          remove-dotnet: 'true'
          remove-android: 'true'
          remove-haskell: 'true'
          remove-codeql: 'true'

      - name: âœ… Validate inputs (éªŒè¯è¾“å…¥å‚æ•°)
        run: |
          # éªŒè¯å†…æ ¸ç‰ˆæœ¬
          case "${{ github.event.inputs.KERNEL_VERSION }}" in
            "6.1"|"5.15"|"5.10")
              echo "Valid kernel version: ${{ github.event.inputs.KERNEL_VERSION }}"
              ;;
            *)
              echo "Unsupported kernel version: ${{ github.event.inputs.KERNEL_VERSION }}"
              exit 1
              ;;
          esac
          
          # éªŒè¯Androidç‰ˆæœ¬
          case "${{ github.event.inputs.ANDROID_VERSION }}" in
            "android14"|"android13"|"android12")
              echo "Valid Android version: ${{ github.event.inputs.ANDROID_VERSION }}"
              ;;
            *)
              echo "Unsupported Android version: ${{ github.event.inputs.ANDROID_VERSION }}"
              exit 1
              ;;
          esac

      - name: ğŸ“¦ Configure Git
        run: |
         git config --global user.name "bulid"
         git config --global user.email "2210077278@qq.com"

      - name: ğŸ“¦ Install dependencies (å®‰è£…ä¾èµ–)
        run: |
         sudo apt update && sudo apt upgrade -y
         sudo apt install -y python3 git curl ccache libelf-dev
         
      - name: ğŸ“¥ Restore ccache (æ¢å¤ ccache ç¼“å­˜)
        uses: actions/cache@v3
        with:
          path: /home/runner/.ccache
          key: ccache-${{ runner.os }}-${{ github.ref }}
          restore-keys: |
            ccache-${{ runner.os }}-
            
      - name: ğŸ“¥ Install repo tool
        run: |
         curl https://storage.googleapis.com/git-repo-downloads/repo > ~/repo
         chmod a+x ~/repo
         sudo mv ~/repo /usr/local/bin/repo

      - name: ğŸ“¥ Initialize repo and sync (å…‹éš†å†…æ ¸æºç )
        run: |
         mkdir kernel_workspace && cd kernel_workspace
         repo init -u https://github.com/Xiaomichael/kernel_manifest.git -b refs/heads/oneplus/${{ github.event.inputs.CPU }} -m ${{ github.event.inputs.FEIL }}.xml --depth=1
         repo sync
         rm -f kernel_platform/common/android/abi_gki_protected_exports_* || echo "No protected exports!"
         rm -f kernel_platform/msm-kernel/android/abi_gki_protected_exports_* || echo "No protected exports!"
         
         # ä¿®æ”¹setlocalversionè„šæœ¬
         for script in kernel_platform/common/scripts/setlocalversion kernel_platform/msm-kernel/scripts/setlocalversion kernel_platform/external/dtc/scripts/setlocalversion; do
           if [[ -f "$script" ]]; then
             sed -i 's/ -dirty//g' "$script"
             sed -i '$i res=$(echo "$res" | sed '\''s/-dirty//g'\'')' "$script"
             sed -i '$s|echo "\$res"|echo "-oki${{ github.event.inputs.KERNEL_SUFFIX }}-v$(date +%Y%m%d)"|' "$script"
           fi
         done
          
      - name: âš™ï¸ Set up SukiSU Ultra (é…ç½® SukiSU Ultra)
        run: |
          cd kernel_workspace/kernel_platform
          curl -LSs "https://raw.githubusercontent.com/ShirkNeko/SukiSU-Ultra/main/kernel/setup.sh" | bash -s susfs-dev
          cd ./KernelSU
          KSU_VERSION=$(expr $(/usr/bin/git rev-list --count main) "+" 10606)
          echo "KSUVER=$KSU_VERSION" >> $GITHUB_ENV
          export KSU_VERSION=$KSU_VERSION
          sed -i "s/DKSU_VERSION=12800/DKSU_VERSION=${KSU_VERSION}/" kernel/Makefile
          
      - name: ğŸ”§ Set up SUSFS
        run: |
          cd kernel_workspace
          git clone https://gitlab.com/simonpunk/susfs4ksu.git -b gki-${{ github.event.inputs.ANDROID_VERSION }}-${{ github.event.inputs.KERNEL_VERSION }}
          git clone https://github.com/Xiaomichael/kernel_patches.git
          git clone https://github.com/ShirkNeko/SukiSU_patch.git
          cd kernel_platform
          
          # Copy SUSFS patches
          if [[ -f "../susfs4ksu/kernel_patches/50_add_susfs_in_gki-${{ github.event.inputs.ANDROID_VERSION }}-${{ github.event.inputs.KERNEL_VERSION }}.patch" ]]; then
            cp "../susfs4ksu/kernel_patches/50_add_susfs_in_gki-${{ github.event.inputs.ANDROID_VERSION }}-${{ github.event.inputs.KERNEL_VERSION }}.patch" ./common/
          else
            echo "SUSFS patch not found for this version combination"
            exit 1
          fi
          
          cp ../kernel_patches/next/syscall_hooks.patch ./common/
          cp -r ../susfs4ksu/kernel_patches/fs/* ./common/fs/
          cp -r ../susfs4ksu/kernel_patches/include/linux/* ./common/include/linux/
          
          if [[ "${{ github.event.inputs.lz4kd }}" == "Open" ]]; then
            # Copy lz4k from ShirkNeko
            cp -r ../SukiSU_patch/other/zram/lz4k/include/linux/* ./common/include/linux/
            cp -r ../SukiSU_patch/other/zram/lz4k/lib/* ./common/lib/
            cp -r ../SukiSU_patch/other/zram/lz4k/crypto/* ./common/crypto/
            cp -r ../SukiSU_patch/other/zram/lz4k_oplus ./common/lib/
          fi
          
          cd ./common
          
          # Apply patches with better error handling
          if ! patch -p1 < "50_add_susfs_in_gki-${{ github.event.inputs.ANDROID_VERSION }}-${{ github.event.inputs.KERNEL_VERSION }}.patch"; then
            echo "WARNING: SUSFS patch failed to apply cleanly"
          fi
          
          if [[ -f "../../kernel_patches/69_hide_stuff.patch" ]]; then
            cp ../../kernel_patches/69_hide_stuff.patch ./
            if ! patch -p1 -F 3 < 69_hide_stuff.patch; then
              echo "WARNING: Hide stuff patch failed to apply"
            fi
          fi
          
          if ! patch -p1 -F 3 < syscall_hooks.patch; then
            echo "ERROR: Syscall hooks patch failed to apply"
            exit 1
          fi
          
          if [[ "${{ github.event.inputs.lz4kd }}" == "Open" ]]; then
            if [[ -f "../../SukiSU_patch/other/zram/zram_patch/${{ github.event.inputs.KERNEL_VERSION }}/lz4kd.patch" ]]; then
              cp "../../SukiSU_patch/other/zram/zram_patch/${{ github.event.inputs.KERNEL_VERSION }}/lz4kd.patch" ./
              patch -p1 -F 3 < lz4kd.patch || echo "WARNING: lz4kd patch failed"
            fi
            
            if [[ -f "../../SukiSU_patch/other/zram/zram_patch/${{ github.event.inputs.KERNEL_VERSION }}/lz4k_oplus.patch" ]]; then
              cp "../../SukiSU_patch/other/zram/zram_patch/${{ github.event.inputs.KERNEL_VERSION }}/lz4k_oplus.patch" ./
              patch -p1 -F 3 < lz4k_oplus.patch || echo "WARNING: lz4k_oplus patch failed"
            fi
          fi
          
      - name: ğŸ® Add sched_ext (é£é©°æ¸¸æˆå†…æ ¸è°ƒåº¦)
        if: ${{ github.event.inputs.sched_ext == 'true' }}
        run: |
         cd kernel_workspace/kernel_platform/
         git clone https://github.com/HanKuCha/sched_ext.git --depth=1
         
         # éªŒè¯sched_extæºç 
         if [[ ! -d "./sched_ext" ]]; then
           echo "ERROR: Failed to clone sched_ext repository"
           exit 1
         fi
         
         echo "ğŸ“‹ Contents of sched_ext directory:"
         ls -la ./sched_ext/
         
         # åˆ›å»ºç›®æ ‡ç›®å½•
         mkdir -p ./common/kernel/sched/ext
         
         # å®‰å…¨åœ°å¤åˆ¶sched_extæ–‡ä»¶ï¼Œæ’é™¤.gitç›®å½•
         find ./sched_ext -type f ! -path "*/.git/*" -exec cp {} ./common/kernel/sched/ \; 2>/dev/null || true
         
         # å¦‚æœå­˜åœ¨extå­ç›®å½•ï¼Œå•ç‹¬å¤„ç†
         if [[ -d "./sched_ext/ext" ]]; then
           cp -r ./sched_ext/ext/* ./common/kernel/sched/ext/ 2>/dev/null || true
         fi
         
         # æ¸…ç†ä¸´æ—¶ç›®å½•
         rm -rf ./sched_ext

      - name: ğŸ”§ Apply kernel configurations (åº”ç”¨å†…æ ¸é…ç½®)
        run: |
          cd kernel_workspace/kernel_platform
          
          # åŸºç¡€KSUé…ç½®
          cat >> ./common/arch/arm64/configs/gki_defconfig << 'EOF'
          # KernelSU Configuration
          CONFIG_KSU=y
          CONFIG_KPM=y
          CONFIG_KSU_MANUAL_HOOK=y
          
          # SUSFS Configuration
          CONFIG_KSU_SUSFS=y
          CONFIG_KSU_SUSFS_HAS_MAGIC_MOUNT=y
          CONFIG_KSU_SUSFS_SUS_PATH=y
          CONFIG_KSU_SUSFS_SUS_MOUNT=y
          CONFIG_KSU_SUSFS_AUTO_ADD_SUS_KSU_DEFAULT_MOUNT=y
          CONFIG_KSU_SUSFS_AUTO_ADD_SUS_BIND_MOUNT=y
          CONFIG_KSU_SUSFS_SUS_KSTAT=y
          CONFIG_KSU_SUSFS_SUS_OVERLAYFS=n
          CONFIG_KSU_SUSFS_TRY_UMOUNT=y
          CONFIG_KSU_SUSFS_AUTO_ADD_TRY_UMOUNT_FOR_BIND_MOUNT=y
          CONFIG_KSU_SUSFS_SPOOF_UNAME=y
          CONFIG_KSU_SUSFS_ENABLE_LOG=y
          CONFIG_KSU_SUSFS_HIDE_KSU_SUSFS_SYMBOLS=y
          CONFIG_KSU_SUSFS_SPOOF_CMDLINE_OR_BOOTCONFIG=y
          CONFIG_KSU_SUSFS_OPEN_REDIRECT=y
          CONFIG_KSU_SUSFS_SUS_SU=n
          
          # BBR
          CONFIG_TCP_CONG_ADVANCED=y
          CONFIG_TCP_CONG_BBR=y
          CONFIG_DEFAULT_BBR=y
          CONFIG_NET_SCH_FQ=y
          CONFIG_TCP_CONG_BIC=n
          CONFIG_TCP_CONG_WESTWOOD=n
          CONFIG_TCP_CONG_HTCP=n
          EOF
          
          # lz4kdé…ç½®
          if [[ "${{ github.event.inputs.lz4kd }}" == "Open" ]]; then
            cat >> ./common/arch/arm64/configs/gki_defconfig << 'EOF'
          
          # LZ4KD Configuration
          CONFIG_ZSMALLOC=y
          CONFIG_CRYPTO_LZ4HC=y
          CONFIG_CRYPTO_LZ4K=y
          CONFIG_CRYPTO_LZ4KD=y
          CONFIG_CRYPTO_842=y
          CONFIG_CRYPTO_LZ4K_OPLUS=y
          CONFIG_ZRAM_WRITEBACK=y
          EOF
            echo "âœ… lz4kd configuration added"
          fi
          
          # ç§»é™¤defconfigæ£€æŸ¥
          sed -i 's/check_defconfig//' ./common/build.config.gki
          
          echo "ğŸ“‹ Final kernel configuration:"
          tail -20 ./common/arch/arm64/configs/gki_defconfig
          
      - name: ğŸ”¨ Build Kernel (æ„å»ºå†…æ ¸)
        run: |
          cd kernel_workspace/kernel_platform
          
          # è®¾ç½®ç¼–è¯‘ç¯å¢ƒ
          export PATH="/usr/lib/ccache:$PATH"
          
          if [[ "${{ github.event.inputs.KERNEL_VERSION }}" == "6.1" ]]; then
            # Kernel 6.1 æ„å»º
            export PATH="$GITHUB_WORKSPACE/kernel_workspace/kernel_platform/prebuilts/clang/host/linux-x86/clang-r487747c/bin:$PATH"
            
            cd common
            echo "ğŸ”§ Building kernel 6.1 with Clang..."
            make -j$(nproc --all) \
              LLVM=1 \
              ARCH=arm64 \
              CROSS_COMPILE=aarch64-linux-gnu- \
              CC=clang \
              RUSTC=../../prebuilts/rust/linux-x86/1.73.0b/bin/rustc \
              PAHOLE=../../prebuilts/kernel-build-tools/linux-x86/bin/pahole \
              LD=ld.lld \
              HOSTLD=ld.lld \
              O=out \
              KCFLAGS+=-O2 \
              CONFIG_LTO_CLANG=y \
              CONFIG_LTO_CLANG_THIN=y \
              CONFIG_LTO_CLANG_FULL=n \
              CONFIG_LTO_NONE=n \
              gki_defconfig all
              
          elif [[ "${{ github.event.inputs.KERNEL_VERSION }}" == "5.15" ]] || [[ "${{ github.event.inputs.KERNEL_VERSION }}" == "5.10" ]]; then
            # Kernel 5.15/5.10 æ„å»º
            echo "ğŸ”§ Building kernel ${{ github.event.inputs.KERNEL_VERSION }} with oplus build script..."
            cd ..
            LTO=thin ./kernel_platform/oplus/build/oplus_build_kernel.sh ${{ github.event.inputs.CPUD }} gki
          else
            echo "âŒ Unsupported kernel version: ${{ github.event.inputs.KERNEL_VERSION }}"
            exit 1
          fi
          
          echo "âœ… Kernel build completed"
          
      - name: ğŸ“¦ Package kernel to AnyKernel3 (æ‰“åŒ…å†…æ ¸åˆ° AnyKernel3)
        run: |
          git clone https://github.com/Suxiaoqinx/AnyKernel3 --depth=1
          rm -rf ./AnyKernel3/.git
          
          # æœç´¢Imageæ–‡ä»¶çš„å¯èƒ½ä½ç½®
          possible_dirs=(
            "kernel_workspace/kernel_platform/out/msm-kernel-${{ github.event.inputs.CPUD }}-gki/dist/"
            "kernel_workspace/kernel_platform/bazel-out/k8-fastbuild/bin/msm-kernel/${{ github.event.inputs.CPUD }}_gki_kbuild_mixed_tree/"
            "kernel_workspace/kernel_platform/out/msm-${{ github.event.inputs.CPUD }}-${{ github.event.inputs.CPUD }}-gki/dist/"
            "kernel_workspace/kernel_platform/out/msm-kernel-${{ github.event.inputs.CPUD }}-gki/gki_kernel/common/arch/arm64/boot/"
            "kernel_workspace/kernel_platform/out/msm-${{ github.event.inputs.CPUD }}-${{ github.event.inputs.CPUD }}-gki/gki_kernel/common/arch/arm64/boot/"
            "kernel_workspace/kernel_platform/common/out/arch/arm64/boot/"
          )
          
          image_path=""
          for dir in "${possible_dirs[@]}"; do
            if [[ -f "${dir}Image" ]]; then
              image_path="${dir}Image"
              echo "âœ… Found Image at: $image_path"
              break
            fi
          done
          
          # é€šç”¨æœç´¢
          if [[ -z "$image_path" ]]; then
            image_path=$(find "./kernel_workspace/kernel_platform/" -name "Image" -type f | head -n 1)
          fi
          
          if [[ -n "$image_path" ]] && [[ -f "$image_path" ]]; then
            # ç¡®ä¿ç›®æ ‡ç›®å½•å­˜åœ¨
            mkdir -p "kernel_workspace/kernel_platform/out/msm-kernel-${{ github.event.inputs.CPUD }}-gki/dist/"
            target_dir="kernel_workspace/kernel_platform/out/msm-kernel-${{ github.event.inputs.CPUD }}-gki/dist/"
            
            # å¤åˆ¶åˆ°æ ‡å‡†ä½ç½®
            if [[ "$(realpath "$image_path")" != "$(realpath "${target_dir}Image")" ]]; then
              cp "$image_path" "${target_dir}Image"
            fi
            
            # å¤åˆ¶åˆ°AnyKernel3
            cp "${target_dir}Image" ./AnyKernel3/Image
            echo "âœ… Image successfully packaged"
            
            # æ˜¾ç¤ºæ–‡ä»¶ä¿¡æ¯
            ls -lh "${target_dir}Image"
            ls -lh ./AnyKernel3/Image
          else
            echo "âŒ ERROR: Image file not found, build may have failed"
            echo "Searching for any kernel images..."
            find "./kernel_workspace/kernel_platform/" -name "*Image*" -type f
            exit 1
          fi
         
      - name: ğŸ› ï¸ KPM Patching Image Files (KPM ä¿®è¡¥ Image æ–‡ä»¶)
        if: ${{ github.event.inputs.KPM_ext == 'true' }}
        run: |
          cd kernel_workspace/kernel_platform/out/msm-kernel-${{ github.event.inputs.CPUD }}-gki/dist
          echo "ğŸ”„ Downloading KPM patcher..."
          curl -LO https://github.com/ShirkNeko/SukiSU_KernelPatch_patch/releases/download/0.11.4/patch_linux
          chmod +x patch_linux
          
          if [[ -f "Image" ]]; then
            echo "ğŸ”§ Applying KPM patch..."
            ./patch_linux
            if [[ -f "oImage" ]]; then
              rm -f Image
              mv oImage Image
              cp Image $GITHUB_WORKSPACE/AnyKernel3/Image
              echo "âœ… KPM patch applied successfully"
            else
              echo "âŒ KPM patch failed - oImage not found"
              exit 1
            fi
          else
            echo "âŒ Image file not found for KPM patching"
            exit 1
          fi

      - name: ğŸ› ï¸ Download Zram module (ä¸‹è½½Zramé™„åŠ æ¨¡å—)
        if: ${{ github.event.inputs.lz4kd == 'Open' }}
        run: |
          cd $GITHUB_WORKSPACE/AnyKernel3
          echo "ğŸ“¥ Downloading zram.zip..."
          curl -LO https://raw.githubusercontent.com/Suxiaoqinx/kernel_manifest_OnePlus_Sukisu_Ultra/main/zram.zip
          if [[ -f "zram.zip" ]]; then
            echo "âœ… zram.zip downloaded successfully"
            ls -lh zram.zip
          else
            echo "âŒ Failed to download zram.zip"
            exit 1
          fi

      - name: å‹ç¼©å¹¶è¾“å‡ºä¿¡æ¯
        run: |
          cd $GITHUB_WORKSPACE/AnyKernel3
          # å®šä¹‰æ–‡ä»¶åå˜é‡
          zip_file="AnyKernel3_SukiSU_Ultra_${{ env.KSUVER }}_${{ github.event.inputs.FEIL }}.zip"
    
          # æ‰§è¡Œå‹ç¼©
          echo "æ­£åœ¨åˆ›å»ºå‹ç¼©åŒ…: $zip_file"
          zip -r "./$zip_file" ./*
    
          # è·å–å®Œæ•´è·¯å¾„å¹¶è¾“å‡º
          full_path="$(pwd)/$zip_file"
          echo "å‹ç¼©åŒ…å·²åˆ›å»ºåœ¨: $full_path"
    
          # ä¿å­˜ä¸ºç¯å¢ƒå˜é‡ä¾›åç»­æ­¥éª¤ä½¿ç”¨
          echo "ZIP_FULL_PATH=$full_path" >> $GITHUB_ENV
          echo "ZIP_FILE_NAME=$zip_file" >> $GITHUB_ENV  # æ–°å¢ä¿å­˜æ–‡ä»¶åå˜é‡

      - name: ä¸Šä¼  ZIP å·¥ä»¶
        uses: actions/upload-artifact@v4
        with:
          name: Kernel_ZIP_Artifacts
          path: ${{ env.ZIP_FULL_PATH }}  # ä½¿ç”¨å®Œæ•´è·¯å¾„

  release:
    needs: build
    runs-on: ubuntu-latest
    permissions:
      contents: write
      packages: write
      actions: read
      
    steps:
      - name: æ£€æŸ¥ç¯å¢ƒå˜é‡
        run: |
          echo "KSUVER: ${{ env.KSUVER }}"
          echo "FEIL: ${{ github.event.inputs.FEIL }}"
    
      - name: ä¸‹è½½ ZIP å·¥ä»¶
        uses: actions/download-artifact@v4
        with:
          name: Kernel_ZIP_Artifacts
          path: ./release_zips
          
      # æ£€æŸ¥ä¸‹è½½çš„æ–‡ä»¶
      - name: åˆ—å‡ºä¸‹è½½çš„æ–‡ä»¶
        run: |
          echo "ä¸‹è½½çš„æ–‡ä»¶åˆ—è¡¨:"
          ls -lh ./release_zips
          echo "ç¯å¢ƒå˜é‡ ZIP_FILE_NAME: ${{ env.ZIP_FILE_NAME }}"
    
      - name: åˆ›å»ºå‘å¸ƒ
        id: create_release
        uses: softprops/action-gh-release@v1
        with:
          # æ·»åŠ æˆ–æ›´æ–°è¿™äº›è¾“å…¥
          tag_name: "${{ github.event.inputs.FEIL }}"
          name: "${{ github.event.inputs.FEIL }}-${{ env.KSUVER }}"
          body: |
            ### æ„å»ºä¿¡æ¯
            - ğŸ“± Device: ${{ github.event.inputs.FEIL }}
            - ğŸ”§ CPU: ${{ github.event.inputs.CPU }} (${{ github.event.inputs.CPUD }})
            - ğŸ§ Kernel: ${{ github.event.inputs.KERNEL_VERSION }}
            - ğŸ¯ KSU Version: ${{ env.KSUVER }}
            - ğŸ—œï¸ LZ4KD: ${{ github.event.inputs.lz4kd }}
            - ğŸ® Sched_ext: ${{ github.event.inputs.sched_ext }}
            - ğŸ” KPM: ${{ github.event.inputs.KPM_ext }}
            - æ¨èç³»ç»Ÿï¼šColorOS 15 / RealmeUI 6.0
            - SukiSUç®¡ç†å™¨ä¸‹è½½ï¼š[SukiSU-Ultra](https://github.com/ShirkNeko/SukiSU-Ultra/releases)
            ### â«ï¸ æ›´æ–°å†…å®¹ï¼š
            - æ›´æ–°SukiSU Ultraè‡³æœ€æ–°ç‰ˆæœ¬ï¼ˆ${{ env.KSUVER }}ï¼‰
            - (é¢„ç•™)
            ### ğŸ“‹ å®‰è£…æ–¹æ³• | Installation Guide
            1. è‹¥ä½ çš„æ‰‹æœºå·²ç»å®‰è£…äº†ç¬¬ä¸‰æ–¹Recoveryï¼ˆå¦‚TWRP)ï¼Œå¯ä¸‹è½½å¯¹åº”æœºå‹çš„AnyKernelåˆ·æœºåŒ…åè¿›å…¥Recoveryæ¨¡å¼ï¼Œé€šè¿‡Recoveryåˆ·å…¥åˆ·æœºåŒ…åé‡å¯è®¾å¤‡
            2. è‹¥ä½ çš„æ‰‹æœºä¹‹å‰å·²æœ‰ root æƒé™ï¼Œå¯åœ¨æ‰‹æœºä¸Šå®‰è£…[HorizonKernelFlasher](https://github.com/libxzr/HorizonKernelFlasher/releases)ï¼Œåœ¨HorizonKernelFlasherä¸­åˆ·å…¥AnyKernelåˆ·æœºåŒ…å¹¶é‡å¯
            3. è‹¥ä½ ä¹‹å‰å·²åˆ·å…¥SukiSU Ultraå†…æ ¸ï¼Œä¸”SukiSU Ultraç®¡ç†å™¨å·²æ›´æ–°è‡³æœ€æ–°ç‰ˆæœ¬ï¼Œå¯åœ¨SukiSU Ultraç®¡ç†å™¨ä¸­ç›´æ¥åˆ·å…¥AnyKernelåˆ·æœºåŒ…å¹¶é‡å¯
            â€»â€»â€»åˆ·å†™å†…æ ¸æœ‰é£é™©ï¼Œä¸ºé˜²æ­¢å‡ºç°æ„å¤–å¯¼è‡´æ‰‹æœºå˜ç –ï¼Œåœ¨åˆ·å…¥å†…æ ¸å‰è¯·åŠ¡å¿…ç”¨[KernelFlasher](https://github.com/capntrips/KernelFlasher)ç­‰è½¯ä»¶å¤‡ä»½bootç­‰å…³é”®å¯åŠ¨åˆ†åŒº!â€»â€»â€»
          draft: false
          prerelease: false
          # å…³é”®ä¿®å¤ï¼šä½¿ç”¨åŠ¨æ€æ–‡ä»¶å
          files: ./release_zips/${{ env.ZIP_FILE_NAME }}
          # ç¡®ä¿å…¶ä»–è®¾ç½®æ­£ç¡®
          generate_release_notes: false
          token: ${{ secrets.GITHUB_TOKEN }}
